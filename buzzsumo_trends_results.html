<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BuzzSumo Trends Results</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        margin: 0;
        padding: 20px;
      }
      .container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
      }
      .card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        width: 320px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        transition: box-shadow 0.2s;
      }
      .card:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      }
      .title {
        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 10px;
      }
      .desc {
        color: #555;
        margin-bottom: 10px;
      }
      .meta {
        font-size: 0.9em;
        color: #888;
      }
      a {
        color: #0078d7;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      .loader {
        text-align: center;
        margin-top: 40px;
        font-size: 1.2em;
        color: #0078d7;
      }
    </style>
  </head>
  <body>
    <h1>BuzzSumo Trends Results</h1>
    <div class="container" id="cards"></div>
    <div class="loader" id="loader">Loading trends...</div>
    <script>
      const selected = JSON.parse(
        localStorage.getItem("buzzsumo_selected_keywords") || "[]"
      );
      if (!selected.length) {
        document.getElementById("loader").textContent = "No keywords selected.";
        throw new Error("No keywords selected");
      }
      // Build the topic string for the API
      const topic = encodeURIComponent(selected.join(","));
      const url = `https://app.buzzsumo.com/search/trends?topic=${topic}&hours=24&count=24&result_type=trending_now&ignore=false&sort=trending_now&countries=India`;

      fetch(url)
        .then((res) => res.json())
        .then((data) => {
          document.getElementById("loader").style.display = "none";
          const trends = data.results || data.trending || data || [];
          const container = document.getElementById("cards");
          if (!Array.isArray(trends) && typeof trends === "object") {
            for (const key in trends) {
              if (Array.isArray(trends[key])) {
                renderCards(trends[key], container);
                return;
              }
            }
          }
          renderCards(trends, container);
        })
        .catch(() => {
          document.getElementById("loader").textContent =
            "Failed to load trends.";
        });

      function renderCards(trends, container) {
        if (!trends || !trends.length) {
          container.innerHTML = "<p>No trends found.</p>";
          return;
        }
        trends.forEach((trend) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
          ${
            trend.thumbnail
              ? `<img src="${trend.thumbnail}" alt="thumbnail" style="width:100%;border-radius:6px 6px 0 0;object-fit:cover;max-height:180px;margin-bottom:12px;" />`
              : ""
          }
          <div class="title">${trend.title || trend.domain || "No Title"}</div>
          <div class="desc">${
            trend.summary || trend.snippet || trend.description || ""
          }</div>
          <div class="meta">
            <span style='color:#555;'>ðŸ•’ ${
              trend.published_date_diff || trend.published_date || ""
            }</span><br>
            ${
              trend.url
                ? `<a href="${trend.url}" target="_blank">Read more</a>`
                : ""
            }
            ${
              trend.engagements
                ? `<span> | Engagements: ${trend.engagements}</span>`
                : ""
            }
          </div>
        `;
          container.appendChild(card);
        });
      }
    </script>
  </body>
</html>
